# the following variables are used within this file that may be specified before
# BUILD_TYPE
# CC
# CXXFLAGS
# CMAKE_FLAGS
# CXX
# DXT_TEST_TIMEOUT
# VENV
# WERROR

DIR="$(cd "$(dirname ${BASH_SOURCE[0]})" ;  pwd -P )"

if [[ ${WERROR} == 1 ]]; then
  CXXFLAGS="-Werror -Wno-error=unknown-pragmas -Wno-error=pedantic ${CXXFLAGS}"
fi

CXXFLAGS=" \
  -std=c++17 \
  -fPIC \
  -fno-strict-aliasing \
  ${CXXFLAGS} \
"

CMAKE_FLAGS="\
    -DBUILD_SHARED_LIBS=TRUE \
    -DCMAKE_BUILD_TYPE=${BUILD_TYPE} \
    -DCMAKE_CXX_COMPILER=${CXX} \
    -DCMAKE_CXX_FLAGS='${CXXFLAGS}' \
    -DCMAKE_CXX_STANDARD=17 \
    -DCMAKE_C_COMPILER=${CC} \
    -DCMAKE_DISABLE_FIND_PACKAGE_QuadMath=TRUE \
    -DDUNE_PYTHON_ALLOW_GET_PIP=FALSE \
    -DDUNE_PYTHON_SYSTEM_IS_VIRTUALENV=1 \
    -DDUNE_PYTHON_VIRTUALENV_PATH=${VIRTUAL_ENV} \
    -DDUNE_PYTHON_VIRTUALENV_SETUP=TRUE \
    -DENABLE_HEADERCHECK=1 \
    -DPDELAB_DISABLE_CXX_VERSION_CHECK=1 \
    -DPYBIND11_PYTHON_VERSION=3 \
    -DPython3_EXECUTABLE=${VIRTUAL_ENV}/bin/python3 \
    -Wno-dev \
    ${CMAKE_FLAGS}
    "
